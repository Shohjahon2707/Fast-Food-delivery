<!DOCTYPE html>
<html>
<head>
    <title>–û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 500px; margin: 50px auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"] { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; width: 100%; }
        button:hover { background: #0056b3; }
        .error { color: red; margin: 10px 0; padding: 10px; background: #ffeaea; border-radius: 4px; }
        .success { color: green; margin: 10px 0; padding: 10px; background: #eaffea; border-radius: 4px; }
        .order-info { background: #f8f9fa; padding: 15px; border-radius: 4px; margin-bottom: 20px; }
        .form-hint { font-size: 12px; color: #666; margin-top: 5px; }
    </style>
</head>
<body>
    <h1>üí≥ –û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</h1>
    
    <div class="order-info">
        <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ:</h3>
        <p><strong>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞:</strong> #{{ order.id }}</p>
        <p><strong>–°—É–º–º–∞:</strong> {{ order.total_price }} UZS</p>
    </div>

    {% if error %}
        <div class="error">{{ error }}</div>
    {% endif %}

    <form method="post">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="card_number">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã:</label>
            <input type="text" id="card_number" name="card_number" 
                   placeholder="0000 0000 0000 0000" maxlength="19" required
                   pattern="[0-9\s]{19}" title="–í–≤–µ–¥–∏—Ç–µ 16 —Ü–∏—Ñ—Ä –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã">
            <div class="form-hint">–í–≤–µ–¥–∏—Ç–µ 16 —Ü–∏—Ñ—Ä –Ω–æ–º–µ—Ä–∞ –≤–∞—à–µ–π –∫–∞—Ä—Ç—ã</div>
        </div>

        <div class="form-group">
            <label for="phone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:</label>
            <input type="tel" id="phone" name="phone" 
                   placeholder="+998 90 123 45 67" required
                   pattern="\+998\s\d{2}\s\d{3}\s\d{2}\s\d{2}" title="–§–æ—Ä–º–∞—Ç: +998 90 123 45 67">
            <div class="form-hint">–§–æ—Ä–º–∞—Ç: +998 XX XXX XX XX</div>
        </div>

        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</button>
    </form>

    <div class="mt-3">
      <a href="{% url 'order_list' %}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –∑–∞–∫–∞–∑–∞–º</a>
  </div>

    <script>
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã (16 —Ü–∏—Ñ—Ä)
        document.getElementById('card_number').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
            
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 16 —Ü–∏—Ñ—Ä
            if (value.length > 16) {
                value = value.substr(0, 16);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã –∫–∞–∂–¥—ã–µ 4 —Ü–∏—Ñ—Ä—ã
            let formatted = value.replace(/(\d{4})/g, '$1 ').trim();
            e.target.value = formatted;
        });

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∑–±–µ–∫—Å–∫–æ–≥–æ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        document.getElementById('phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            
            // –ï—Å–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 998, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
            if (value.startsWith('998')) {
                value = value.substr(3);
            }
            
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 9 —Ü–∏—Ñ—Ä (–±–µ–∑ –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã)
            if (value.length > 9) {
                value = value.substr(0, 9);
            }
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: +998 XX XXX XX XX
            let formatted = '+998 ';
            if (value.length > 0) {
                formatted += value.substr(0, 2);
            }
            if (value.length > 2) {
                formatted += ' ' + value.substr(2, 3);
            }
            if (value.length > 5) {
                formatted += ' ' + value.substr(5, 2);
            }
            if (value.length > 7) {
                formatted += ' ' + value.substr(7, 2);
            }
            
            e.target.value = formatted;
        });

        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤–≤–æ–¥ –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –≤ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã
        document.getElementById('card_number').addEventListener('keypress', function(e) {
            if (!/[0-9]/.test(e.key) && e.key !== 'Backspace' && e.key !== 'Delete' && e.key !== 'Tab') {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>